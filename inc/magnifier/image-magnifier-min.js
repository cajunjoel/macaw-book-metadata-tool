YAHOO.widget.ImageMagnifier=function(img,src){var YD=YAHOO.util.Dom;var YE=YAHOO.util.Event;var YL=YAHOO.lang;var _elem;var _canvas;var _magnifiedImage;function _init(){var xratio,yratio,dim,oval,fill,ctx,drawMagnifiedImageFn,dd;xratio=_magnifiedImage.width/img.width;yratio=_magnifiedImage.height/img.height;dim=Math.floor(_elem.clientWidth/2)-1;if(YAHOO.env.ua.ie){oval=document.createElement("v:oval");oval.style.position="absolute";oval.style.left=oval.style.top="0px";oval.style.width=_canvas.offsetWidth+"px";oval.style.height=_canvas.offsetHeight+"px";fill=document.createElement("v:fill");fill.type="frame";fill.src=_magnifiedImage.src;fill.size=(_magnifiedImage.width/_canvas.offsetWidth)+", "+(_magnifiedImage.height/_canvas.offsetHeight);oval.appendChild(fill);_canvas.appendChild(oval);drawMagnifiedImageFn=function(){var dx,dy;dx=(YD.getX(_elem)+_elem.clientWidth/2)-(YD.getX(img)+img.width/2);dy=(YD.getY(_elem)+_elem.clientHeight/2)-(YD.getY(img)+img.height/2);fill.position=(-xratio*(dx/_canvas.offsetWidth))+", "+(-yratio*(dy/_canvas.offsetHeight));};}else{ctx=_canvas.getContext("2d");ctx.beginPath();ctx.arc(dim,dim,dim,0,2*Math.PI,true);ctx.clip();drawMagnifiedImageFn=function(){var sx,sy,sw,sh,dx,dy,dw,dh;dx=dy=0;sw=sh=dw=dh=2*dim;ctx.fillStyle="#FFFFFF";ctx.fillRect(0,0,dw,dh);sx=Math.floor((YD.getX(_canvas)-YD.getX(img)+_elem.offsetWidth/2)*xratio-dim);sy=Math.floor((YD.getY(_canvas)-YD.getY(img)+_elem.offsetHeight/2)*yratio-dim);if(sx<0){dx=-sx;sx=0;}if(sy<0){dy=-sy;sy=0;}if(sx>_magnifiedImage.width||sy>_magnifiedImage.height||sx+sw<0||sy+sh<0){return;}if(sx+sw>_magnifiedImage.width){sw=_magnifiedImage.width-sx;dw=sw;}if(sy+sh>_magnifiedImage.height){sh=_magnifiedImage.height-sy;dh=sh;}ctx.drawImage(_magnifiedImage,sx,sy,sw,sh,dx,dy,dw,dh);};}YD.setX(_elem,YD.getX(img)+Math.floor((img.width-_elem.clientWidth)/2));YD.setY(_elem,YD.getY(img)+Math.floor((img.height-_elem.clientHeight)/2));_elem.style.visibility="visible";if(YAHOO.env.ua.ie)setTimeout(drawMagnifiedImageFn,0);else drawMagnifiedImageFn();dd=new YAHOO.util.DD(_elem,'',{scroll:false});dd.onDrag=function(evt){drawMagnifiedImageFn();};}(function(){var lens,ss,loadTimer;img=YD.get(img);if(!img||img.tagName!=="IMG"||typeof src!=="string"){throw new Error("Invalid argument");}_elem=document.createElement("DIV");_elem.className="magnifier";document.body.appendChild(_elem);lens=document.createElement("DIV");lens.className="lens";lens.unselectable="on";_elem.appendChild(lens);if(YAHOO.env.ua.ie){document.namespaces.add("v","urn:schemas-microsoft-com:vml");ss=document.createStyleSheet();ss.addRule("v\\:*","behavior:url(#default#VML);");_canvas=document.createElement("DIV");_canvas.style.width=(lens.clientWidth-2)+"px";_canvas.style.height=(lens.clientHeight-2)+"px";}else{_canvas=document.createElement("CANVAS");_canvas.width=lens.clientWidth-2;_canvas.height=lens.clientHeight-2;}_canvas.style.position="absolute";_canvas.style.left=_canvas.style.top="1px";_elem.appendChild(_canvas);_magnifiedImage=new Image();_magnifiedImage.src=src;loaddiv=document.createElement("DIV");var loadtext=document.createTextNode('Lupe wird geladen...');loaddiv.appendChild(loadtext);YAHOO.util.Dom.addClass(loaddiv,'loaddiv');loadTimer=setInterval(function(){if(img.complete&&_magnifiedImage.complete){clearInterval(loadTimer);if(YAHOO.util.Dom.inDocument(loaddiv)){YAHOO.util.Dom.getElementsByClassName('loaddiv','DIV','big_bild_div',function(o){document.getElementById('big_bild_div').removeChild(o);});}_init();}else{document.getElementById('big_bild_div').appendChild(loaddiv);}},100);})();};